flowchart TB
    subgraph Internet
        USER[/"ğŸ‘¤ Users"/]
        ATTACKER[/"ğŸ”´ Attackers"/]
    end

    subgraph Cloud["Cloud Provider"]
        LB["âš–ï¸ Load Balancer<br/>(PROXY Protocol)"]
    end

    subgraph K8S["Kubernetes Cluster"]
        
        subgraph nginx-ns["namespace: nginx"]
            NGINX["ğŸŒ NGINX Ingress Controller"]
            LUA["ğŸ“¦ Lua Bouncer Plugin"]
        end

        subgraph crowdsec-ns["namespace: crowdsec"]
            LAPI["ğŸ›¡ï¸ CrowdSec LAPI<br/>(Local API)"]
            AGENT["ğŸ“Š CrowdSec Agent<br/>(Log Processor)"]
            APPSEC["ğŸ”¥ CrowdSec AppSec<br/>(WAF Engine)"]
        end

        subgraph postgres-ns["namespace: database"]
            PG[("ğŸ—„ï¸ PostgreSQL")]
        end

        subgraph monitoring-ns["namespace: monitoring"]
            LOKI["ğŸ“‹ Loki"]
        end

        subgraph backend-ns["namespace: backend"]
            CORE["âš™ï¸ App Server"]
        end
    end

    subgraph Console["CrowdSec Console"]
        CLOUD["â˜ï¸ Threat Intelligence"]
    end

    USER --> LB
    ATTACKER --> LB
    LB -->|"HTTPS"| NGINX
    NGINX --> LUA
    LUA -->|"Check Ban"| LAPI
    LUA -->|"WAF Analysis"| APPSEC
    APPSEC --> LAPI
    AGENT --> LAPI
    AGENT -.->|"Query Logs"| LOKI
    LAPI --> PG
    LAPI <-.->|"Sync"| CLOUD
    NGINX -->|"âœ… Allowed"| CORE
    LUA -->|"ğŸš« Blocked"| ATTACKER
